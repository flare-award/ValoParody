<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ValoParody - Telegram Game</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="loading-screen" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö –∞—Å—Å–µ—Ç–æ–≤...</div>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
    </div>

    <div id="game-container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="screen active">
            <div class="logo">
                <h1><span class="red">VAL</span><span class="white">OPARODY</span></h1>
                <div class="subtitle">Telegram Edition</div>
            </div>
            
            <div class="menu-options">
                <button class="menu-btn" onclick="startGame()">
                    <i class="fas fa-play"></i> –ò–≥—Ä–∞—Ç—å
                </button>
                <button class="menu-btn" onclick="showAgents()">
                    <i class="fas fa-user"></i> –ê–≥–µ–Ω—Ç—ã
                </button>
                <button class="menu-btn" onclick="showWeapons()">
                    <i class="fas fa-gun"></i> –û—Ä—É–∂–∏–µ
                </button>
                <button class="menu-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button class="menu-btn" onclick="showStats()">
                    <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </button>
            </div>
            
            <div class="game-info">
                <div class="player-info">
                    <div class="player-avatar">üë§</div>
                    <div class="player-name" id="player-name">–ò–≥—Ä–æ–∫</div>
                    <div class="player-level">–£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span></div>
                </div>
                <div class="currency">
                    <i class="fas fa-coins"></i>
                    <span id="credits">800</span>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞ -->
        <div id="agent-select" class="screen">
            <h2><i class="fas fa-user-secret"></i> –í—ã–±–µ—Ä–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞</h2>
            <div class="agents-grid" id="agents-container">
                <!-- –ê–≥–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <button class="back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–æ–∫—É–ø–∫–∏ –æ—Ä—É–∂–∏—è -->
        <div id="buy-menu" class="screen">
            <h2><i class="fas fa-shopping-cart"></i> –ú–∞–≥–∞–∑–∏–Ω</h2>
            <div class="weapon-categories">
                <button class="category-btn active" onclick="filterWeapons('all')">–í—Å–µ</button>
                <button class="category-btn" onclick="filterWeapons('pistol')">–ü–∏—Å—Ç–æ–ª–µ—Ç—ã</button>
                <button class="category-btn" onclick="filterWeapons('rifle')">–í–∏–Ω—Ç–æ–≤–∫–∏</button>
                <button class="category-btn" onclick="filterWeapons('sniper')">–°–Ω–∞–π–ø–µ—Ä–∫–∏</button>
                <button class="category-btn" onclick="filterWeapons('heavy')">–¢—è–∂–µ–ª—ã–µ</button>
            </div>
            <div class="weapons-grid" id="weapons-container">
                <!-- –û—Ä—É–∂–∏–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
            </div>
            <div class="buy-menu-footer">
                <div class="current-credits">
                    <i class="fas fa-coins"></i> <span id="current-credits">800</span>
                </div>
                <button class="action-btn primary" onclick="startRound()">
                    <i class="fas fa-fighter-jet"></i> –ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥
                </button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="game-screen" class="screen">
            <canvas id="game-canvas"></canvas>
            
            <div class="hud">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="hud-left">
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill"></div>
                        <span class="health-text" id="health-text">100</span>
                    </div>
                    <div class="armor-bar">
                        <div class="armor-fill" id="armor-fill"></div>
                        <span class="armor-text" id="armor-text">50</span>
                    </div>
                    <div class="ammo">
                        <span id="current-ammo">12</span>/<span id="total-ammo">24</span>
                    </div>
                </div>
                
                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="hud-center">
                    <div class="round-info">
                        –†–∞—É–Ω–¥: <span id="round-number">1</span>/13
                    </div>
                    <div class="timer" id="round-timer">1:45</div>
                    <div class="kill-feed" id="kill-feed"></div>
                </div>
                
                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="hud-right">
                    <div class="score">
                        <div class="team attack">
                            <span class="team-name">–ê–¢–ê–ö–ê</span>
                            <span class="team-score" id="attack-score">0</span>
                        </div>
                        <div class="team defense">
                            <span class="team-name">–ó–ê–©–ò–¢–ê</span>
                            <span class="team-score" id="defense-score">0</span>
                        </div>
                    </div>
                    <div class="weapon-info">
                        <div class="weapon-name" id="current-weapon">Classic</div>
                        <div class="weapon-mode" id="fire-mode">–û–¥–∏–Ω–æ—á–Ω—ã–π</div>
                    </div>
                    <div class="abilities">
                        <button class="ability-btn" id="ability1" onclick="useAbility(1)">Q</button>
                        <button class="ability-btn" id="ability2" onclick="useAbility(2)">E</button>
                        <button class="ability-btn" id="ability3" onclick="useAbility(3)">C</button>
                        <button class="ability-btn" id="ability4" onclick="useAbility(4)">X</button>
                    </div>
                </div>
            </div>
            
            <div class="minimap-container">
                <canvas id="minimap" width="150" height="150"></canvas>
            </div>
            
            <div class="game-controls">
                <button class="control-btn" onclick="openBuyMenu()">
                    <i class="fas fa-shopping-cart"></i> –ú–∞–≥–∞–∑–∏–Ω
                </button>
                <button class="control-btn" onclick="showMap()">
                    <i class="fas fa-map"></i> –ö–∞—Ä—Ç–∞
                </button>
                <button class="control-btn" onclick="pauseGame()">
                    <i class="fas fa-pause"></i> –ü–∞—É–∑–∞
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–∞—É–∑—ã -->
        <div id="pause-screen" class="screen">
            <div class="pause-container">
                <h2><i class="fas fa-pause-circle"></i> –ü–∞—É–∑–∞</h2>
                <div class="pause-options">
                    <button class="pause-btn" onclick="resumeGame()">
                        <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                    <button class="pause-btn" onclick="showSettings()">
                        <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                    <button class="pause-btn" onclick="showMainMenu()">
                        <i class="fas fa-home"></i> –í –º–µ–Ω—é
                    </button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <h2><i class="fas fa-trophy"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞</h2>
                <div class="results-content">
                    <div class="team-result attack">
                        <h3>–ê–¢–ê–ö–ê</h3>
                        <div class="result-score" id="final-attack-score">0</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="team-result defense">
                        <h3>–ó–ê–©–ò–¢–ê</h3>
                        <div class="result-score" id="final-defense-score">0</div>
                    </div>
                </div>
                <div class="player-stats">
                    <h3>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat">
                            <i class="fas fa-skull"></i>
                            <span class="stat-value" id="stat-kills">0</span>
                            <span class="stat-label">–£–±–∏–π—Å—Ç–≤</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-dizzy"></i>
                            <span class="stat-value" id="stat-deaths">0</span>
                            <span class="stat-label">–°–º–µ—Ä—Ç–µ–π</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-handshake"></i>
                            <span class="stat-value" id="stat-assists">0</span>
                            <span class="stat-label">–ü–æ–º–æ—â–∏</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-money-bill-wave"></i>
                            <span class="stat-value" id="stat-money">0</span>
                            <span class="stat-label">–î–µ–Ω—å–≥–∏</span>
                        </div>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="action-btn primary" onclick="nextRound()">
                        <i class="fas fa-redo"></i> –°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥
                    </button>
                    <button class="action-btn secondary" onclick="showMainMenu()">
                        <i class="fas fa-home"></i> –í –º–µ–Ω—é
                    </button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-screen" class="screen">
            <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="settings-container">
                <div class="setting-group">
                    <h3>–ì—Ä–∞—Ñ–∏–∫–∞</h3>
                    <div class="setting">
                        <label>–ö–∞—á–µ—Å—Ç–≤–æ –≥—Ä–∞—Ñ–∏–∫–∏</label>
                        <select id="graphics-quality">
                            <option value="low">–ù–∏–∑–∫–æ–µ</option>
                            <option value="medium" selected>–°—Ä–µ–¥–Ω–µ–µ</option>
                            <option value="high">–í—ã—Å–æ–∫–æ–µ</option>
                        </select>
                    </div>
                    <div class="setting">
                        <label>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ</label>
                        <select id="resolution">
                            <option value="low">–ù–∏–∑–∫–æ–µ (640x480)</option>
                            <option value="medium" selected>–°—Ä–µ–¥–Ω–µ–µ (800x600)</option>
                            <option value="high">–í—ã—Å–æ–∫–æ–µ (1024x768)</option>
                        </select>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>–ó–≤—É–∫</h3>
                    <div class="setting">
                        <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</label>
                        <input type="range" id="sfx-volume" min="0" max="100" value="70">
                        <span id="sfx-volume-value">70%</span>
                    </div>
                    <div class="setting">
                        <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏</label>
                        <input type="range" id="music-volume" min="0" max="100" value="50">
                        <span id="music-volume-value">50%</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <div class="setting">
                        <label>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º—ã—à–∏</label>
                        <input type="range" id="mouse-sensitivity" min="1" max="10" value="5">
                        <span id="mouse-sensitivity-value">5</span>
                    </div>
                    <div class="setting">
                        <label>–ò–Ω–≤–µ—Ä—Å–∏—è –º—ã—à–∏</label>
                        <input type="checkbox" id="invert-mouse">
                    </div>
                </div>
            </div>
            <button class="back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </button>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification" class="notification"></div>

    <!-- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <div id="virtual-joystick" class="virtual-joystick">
        <div class="joystick-base"></div>
        <div class="joystick-handle"></div>
    </div>

    <script src="game.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                const tg = Telegram.WebApp;
                tg.expand();
                tg.ready();
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤
                tg.setHeaderColor('#fd4556');
                tg.setBackgroundColor('#0f1923');
                
                // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    const playerName = document.getElementById('player-name');
                    if (playerName) {
                        playerName.textContent = user.first_name || user.username || '–ò–≥—Ä–æ–∫';
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    localStorage.setItem('telegram_user_id', user.id);
                    localStorage.setItem('telegram_username', user.username || '');
                    localStorage.setItem('telegram_first_name', user.first_name || '');
                }
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
                tg.BackButton.show();
                tg.BackButton.onClick(function() {
                    if (window.game && window.game.gameState === 'game') {
                        showMainMenu();
                    } else {
                        history.back();
                    }
                });
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            setTimeout(() => {
                if (typeof initGame === 'function') {
                    initGame();
                }
            }, 1000);
        });
    </script>
</body>
</html>